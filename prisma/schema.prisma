// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int      @id @default(autoincrement())
  email             String   @unique
  passwordHash      String?  @map("password_hash") // ì†Œì…œ ë¡œê·¸ì¸ ì‚¬ìš©ìëŠ” null ê°€ëŠ¥
  name              String?
  emailVerified     Boolean  @default(false) @map("email_verified")
  verificationToken String?  @map("verification_token")
  provider          String?  // 'credentials', 'google', 'kakao' ë“±
  providerId        String?  @map("provider_id") // ì†Œì…œ ë¡œê·¸ì¸ ì œê³µìì˜ ì‚¬ìš©ì ID
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  // ê´€ê³„
  diaries           Diary[]
  subscription      Subscription?
  plant             Plant?
  achievements      Achievement[]
  
  @@map("users")
}

model Diary {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  content     String   // í•œì¤„ ì¼ê¸° ë‚´ìš©
  emotion     String   // ê°ì • íƒœê·¸ (ğŸ˜ŠğŸ˜¢ğŸ˜ ğŸ˜ğŸ˜´)
  weather     String?  // ë‚ ì”¨ (ğŸŒğŸŒ§ï¸â›…)
  mood        Int      @default(5) // ê¸°ë¶„ ì ìˆ˜ (1-10)
  isPrivate   Boolean  @default(true) @map("is_private") // ê³µê°œ ì—¬ë¶€
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  // ê´€ê³„
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("diaries")
}

model Subscription {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique @map("user_id")
  planType    String   @map("plan_type") // 'free', 'premium'
  status      String   @default("active") // 'active', 'cancelled', 'expired'
  startDate   DateTime @default(now()) @map("start_date")
  endDate     DateTime? @map("end_date")
  stripeCustomerId String? @map("stripe_customer_id")
  stripeSubscriptionId String? @map("stripe_subscription_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  // ê´€ê³„
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("subscriptions")
}

model Plant {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique @map("user_id")
  type        String   @default("seedling") // seedling, sprout, young, mature, flowering, fruiting
  level       Int      @default(1)
  experience  Int      @default(0) // ì¼ê¸° ì‘ì„±ìœ¼ë¡œ ì–»ëŠ” ê²½í—˜ì¹˜
  name        String?  // ì‚¬ìš©ìê°€ ì§€ì€ ì‹ë¬¼ ì´ë¦„
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  // ê´€ê³„
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("plants")
}

model Achievement {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  type        String   // first_diary, week_streak, month_streak, emotion_master, etc.
  title       String
  description String
  icon        String   // ì´ëª¨ì§€ ë˜ëŠ” ì•„ì´ì½˜
  unlockedAt  DateTime @default(now()) @map("unlocked_at")
  
  // ê´€ê³„
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, type])
  @@map("achievements")
}